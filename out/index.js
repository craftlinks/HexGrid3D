var G=function(N){for(let F=0;F<H.point_n;++F)N[F*2]=(Math.random()-0.5)*12,N[F*2+1]=(Math.random()-0.5)*12;return N},W=function(N,F,q,A,I){N[F*2]+=q*I,N[F*2+1]+=A*I},K=function(){const{R_val:N,U_val:F,R_grad:q,U_grad:A}=Z,{c_rep:I,mu_k:M,sigma_k:J,w_k:Q}=H;N.fill(C(0,I)[0]),F.fill(Y(0,M,J,Q)[0]),q.fill(0),A.fill(0);for(let B=0;B<H.point_n-1;++B)for(let L=B+1;L<H.point_n;++L){let O=T[B*2]-T[L*2],P=T[B*2+1]-T[L*2+1];const S=Math.sqrt(O*O+P*P)+0.00000000000000000001;if(O/=S,P/=S,S<1){const[E,b]=C(S,I);W(q,B,O,P,b),W(q,L,O,P,-b),N[B]+=E,N[L]+=E}const[$,z]=Y(S,M,J,Q);W(A,B,O,P,z),W(A,L,O,P,-z),F[B]+=$,F[L]+=$}},C=function(N,F){const q=Math.max(1-N,0);return[0.5*F*q*q,-F*q]},D=function(N){let F=1+N/32;return F*=F,F*=F,F*=F,F*=F,F*=F,F},Y=function(N,F,q,A=1){const I=(N-F)/q,M=A/D(I*I);return[M,-2*I*M/q]},h=function(){const{R_val:N,U_val:F,R_grad:q,U_grad:A}=Z,{mu_g:I,sigma_g:M,dt:J}=H;K();let Q=0;for(let B=0;B<H.point_n;++B){const[L,O]=Y(F[B],I,M),P=O*A[B*2]-q[B*2],S=O*A[B*2+1]-q[B*2+1];W(T,B,P,S,J),Q+=N[B]-L}return Q/H.point_n},j=function(N,F=45,q=10){for(let J=0;J<q;++J)h();const{width:A,height:I}=N.canvas;N.resetTransform(),N.clearRect(0,0,A,I),N.translate(A/2,I/2);const M=A/F;N.scale(M,M),N.lineWidth=0.1;for(let J=0;J<H.point_n;++J){N.beginPath();const Q=T[J*2],B=T[J*2+1],L=H.c_rep/(Z.R_val[J]*5);N.arc(Q,B,L,0,Math.PI*2),N.stroke()}},w=function(N){let F=window.devicePixelRatio||1,q=N.getBoundingClientRect();N.width=q.width*F,N.height=q.height*F;let A=N.getContext("2d");return A.scale(F,F),A},U=function(){return w(document.querySelector("canvas"))},H={mu_k:6,sigma_k:0.4,w_k:0.022,mu_g:0.4,sigma_g:0.1,c_rep:1,dt:0.02,point_n:500},X={mu_g:{min:0,max:2,step:0.1},sigma_g:{min:0.1,max:1,step:0.1},w_k:{min:0,max:0.1,step:0.01},mu_k:{min:0,max:10,step:1},sigma_k:{min:0.1,max:1,step:0.1},c_rep:{min:0,max:1,step:0.1},dt:{min:0,max:0.1,step:0.01},point_n:{min:100,max:1000,step:50}},V=document.querySelector("canvas");for(let N in H){let F=document.createElement("label");F.textContent=N,F.htmlFor=N;let q=document.createElement("input");q.type="range",q.id=N,q.value=H[N],q.min=X[N].min,q.max=X[N].max,q.step=X[N].step,q.style.margin="0 5px";let A=document.createElement("span");A.id=N+"_value",A.textContent=H[N],A.style.margin="0 5px",q.addEventListener("input",function(){H[this.id]=this.value,this.value=H[this.id],document.getElementById(this.id+"_value").textContent=this.value}),V.parentNode.insertBefore(F,V),V.parentNode.insertBefore(q,V),V.parentNode.insertBefore(A,V)}var Z={R_val:new Float32Array(H.point_n),U_val:new Float32Array(H.point_n),R_grad:new Float32Array(H.point_n*2),U_grad:new Float32Array(H.point_n*2)},T=G(new Float32Array(H.point_n*2)),R=U();while(!0)j(R),await new Promise(requestAnimationFrame);
